# Epic 5 Retrospective: Output & CLI (Second Retro - Post Story 5.4)

**Date:** 2025-12-02
**Facilitator:** Bob (Scrum Master)
**Epic Reviewed:** Epic 5 - Output & CLI
**Note:** This is the second retrospective for Epic 5. The first retro (2025-12-02) reviewed Stories 5.1-5.3 and discovered the chart data gap, leading to Story 5.4 being added.

---

## Epic Summary

**Goal:** Implement JSON output generation and complete CLI with daemon mode, graceful shutdown, and all operational features.

**Stories Completed:** 4/4 (100%)

| Story | Title | Status | Review Iterations |
|-------|-------|--------|-------------------|
| 5-1 | Implement Output File Generation | done | 1 |
| 5-2 | Implement CLI and Single-Run Mode | done | 4 |
| 5-3 | Implement Daemon Mode | done | 5 |
| 5-4 | Extract Historical Chart Data | done | 1 |

**Review Outcomes:** 4 Approved, 4 Blocked (across iterations)

**Technical Debt:** 2 open items

---

## What Went Well

1. **End-to-End Tool Delivered**
   - First time running the complete pipeline
   - From `go run ./cmd/extractor --once` to JSON output
   - Dashboard now has all data needed

2. **Atomic Write Pattern Rock-Solid**
   - Zero file corruption issues
   - Context-aware cancellation prevents partial writes
   - Production-quality implementation

3. **Story 5.4 Executed Cleanly**
   - One review, approved
   - Clear requirements after first retro discovery
   - 1,466 chart data points extracted

4. **All Epic 4 Commitments Honored (5/5)**
   - Tech spec before stories
   - Smoke test guides in every story
   - Self-review before Senior Dev Review
   - Sprint status updated immediately
   - Vertical slice completed

5. **Retro-Driven Discovery**
   - First Epic 5 retro caught chart data gap
   - Story 5.4 added and completed
   - Dashboard has graphing capability

---

## What Could Be Improved

### 1. Excessive Review Iterations on 5.2/5.3 (HIGH)

**Observation:** Stories 5.2 and 5.3 had 4 and 5 review iterations respectively, with multiple blocked outcomes.

**Root Cause:**
- AC8 (SIGINT handling) was complex cross-cutting concern
- Fixes were incremental rather than holistic
- Each review found another edge case

**Impact:** Extended delivery time, 11 backlog items created

**Recommendation:** Complex cross-cutting requirements should have upfront design doc before implementation.

### 2. Chart Data Gap Not Caught Until User Flagged (HIGH)

**Observation:** BMad (Project Lead) caught that chart data wasn't being extracted during the first Epic 5 retro. The review process had validated implementation against ACs, but the ACs themselves were incomplete.

**Root Cause:**
- PRD FR30-FR34 specified "historical snapshots" - interpreted as extractor-run snapshots only
- Seed doc line 28 mentioned `chart` field but no FR required full extraction
- Validation was forward-only (implementation → ACs) not backward (ACs → source material)

**Impact:** Additional story added mid-epic, delayed completion

**Recommendation:** Add backward validation checkpoint - validate ACs against original source material (seed docs, API specs) before marking epic complete.

### 3. PRD Requirements Gap (MEDIUM)

**Observation:** The PRD distinguished between:
- `historical` - extractor-run snapshots (every 2 hours)
- `chart_history` - API-sourced daily data (4+ years)

But only the former was explicitly required. The latter was implied by the seed doc but never elevated to an FR.

**Impact:** Feature gap in initial delivery

**Recommendation:** During PRD creation, cross-reference all data source fields against requirements to ensure nothing is missed.

---

## Previous Retrospective Status

### Epic 4 Commitments (2025-12-01):

| Commitment | Status | Evidence |
|-----------|--------|----------|
| Draft Epic 5 Tech Spec before stories | ✅ COMPLETED | `tech-spec-epic-5.md` created |
| Self-review before Senior Dev Review | ✅ COMPLETED | All stories show self-review |
| Smoke test guides in every story | ✅ COMPLETED | All 4 stories have guides |
| Update sprint-status.yaml immediately | ✅ COMPLETED | Status properly tracked |
| Complete vertical slice for end-to-end | ✅ COMPLETED | Tool runs end-to-end |

**Result:** 5/5 commitments honored (100%)

### First Epic 5 Retro (2025-12-02):

| Discovery | Action | Status |
|-----------|--------|--------|
| Chart data not being extracted | Add Story 5.4 | ✅ COMPLETED |

---

## FR/NFR Coverage Validation

**Epic 5 FRs Covered:** FR35-FR48, FR56

| FR Range | Description | Status |
|----------|-------------|--------|
| FR35-FR41 | Output Generation | ✅ All implemented |
| FR42-FR48 | CLI Operation | ✅ All implemented |
| FR56 | Extraction Logging | ✅ Implemented |

**NFRs Covered:** NFR1-NFR22 (all applicable)

**Gap Identified:** Chart history for graphing was not an explicit FR. Added via Story 5.4 after retro discovery.

**Additional API Fields Not Extracted (Advisory):**
- `chainChart` - per-chain historical data (potential future enhancement)
- `oraclesTVS` - derived via aggregation instead
- `chainsByOracle` - derived from protocol data

---

## Action Items

### Process Improvements

| # | Action | Owner | Status |
|---|--------|-------|--------|
| 1 | Add backward validation checkpoint - validate ACs against source material before epic completion | Alice (PO) + Bob (SM) | PENDING |
| 2 | Document vertical slice vs horizontal layer tradeoffs (from Epic 4) | Bob (SM) + Alice (PO) | PENDING |
| 3 | Create design doc template for complex cross-cutting requirements | Charlie (Dev) | PENDING |

### Technical Debt

| # | Item | Severity | Status |
|---|------|----------|--------|
| 1 | Daemon integration/smoke tests for signal handling | Medium | Open |
| 2 | Monitor chart_history file size growth | Low | Open |

---

## Team Agreements

Based on this retrospective, the team commits to:

1. **Source-to-AC Validation**: Every epic completion includes a check of ACs against original source material
2. **Holistic Design for Complex ACs**: Requirements spanning multiple layers get a mini design doc before coding
3. **Retro-Driven Discovery is OK**: Adding stories mid-epic when gaps are found is a feature, not a bug

---

## MVP Completion Summary

Epic 5 marks the completion of the defillama-extract MVP.

**Total Project Metrics:**

| Metric | Value |
|--------|-------|
| Total Epics | 5 |
| Total Stories | ~33 |
| Project Duration | 2025-11-29 to 2025-12-02 |
| Chart Data Points | 1,466 |
| Date Range | 2021-11-29 to present |
| Protocols Captured | ~21 |

**Deliverables:**
- `switchboard-oracle-data.json` - Full output with history
- `switchboard-oracle-data.min.json` - Minified output
- `switchboard-summary.json` - Current snapshot + chart history
- Daemon mode with 2-hour intervals
- Graceful shutdown on SIGINT/SIGTERM
- CLI with --once, --config, --dry-run, --version flags

---

## Key Takeaways

1. **Tech specs enable clean execution** - Stories with clear specs (5.1, 5.4) sailed through; complex ones (5.2, 5.3) struggled
2. **Validate backward, not just forward** - ACs must be checked against source material, not just PRD
3. **Retro-driven discovery adds value** - First Epic 5 retro caught chart data gap
4. **Complex requirements need design** - SIGINT handling should have been designed holistically upfront
5. **MVP delivered** - Truth in data for Switchboard is now available

---

## Participants

- Bob (Scrum Master) - Facilitator
- Alice (Product Owner)
- Charlie (Senior Developer)
- Dana (QA Engineer)
- Elena (Junior Developer)
- BMad (Project Lead)

---

## Change Log

| Date | Author | Change |
|------|--------|--------|
| 2025-12-02 | Bob (SM) | Second Epic 5 retrospective - post Story 5.4 completion, MVP complete |
