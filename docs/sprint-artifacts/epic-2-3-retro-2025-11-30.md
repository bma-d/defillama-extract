# Epic 2 & 3 Combined Retrospective

**Date:** 2025-11-30
**Facilitator:** Bob (Scrum Master)
**Epics Reviewed:** Epic 2 (API Integration), Epic 3 (Data Processing Pipeline)

---

## Epic Summary

### Epic 2: API Integration
- **Goal:** Build robust HTTP client for DefiLlama APIs
- **Stories Completed:** 6/6 (100%)
- **Status:** DONE

| Story | Title | Status |
|-------|-------|--------|
| 2-1 | Implement Base HTTP Client with Timeout and User-Agent | done |
| 2-2 | Implement Oracle Endpoint Fetcher | done |
| 2-3 | Implement Protocol Endpoint Fetcher | done |
| 2-4 | Implement Retry Logic with Exponential Backoff | done |
| 2-5 | Implement Parallel Fetching with errgroup | done |
| 2-6 | Implement API Request Logging | done |

### Epic 3: Data Processing Pipeline
- **Goal:** Implement filtering, aggregation, and metrics calculation
- **Stories Completed:** 7/7 (100%)
- **Status:** DONE

| Story | Title | Status |
|-------|-------|--------|
| 3-1 | Implement Protocol Filtering by Oracle Name | done |
| 3-2 | Extract Protocol Metadata and TVS Data | done |
| 3-3 | Calculate Total TVS and Chain Breakdown | done |
| 3-4 | Calculate Category Breakdown | done |
| 3-5 | Rank Protocols and Identify Largest | done |
| 3-6 | Calculate Historical Change Metrics | done |
| 3-7 | Build Complete Aggregation Pipeline | done |

---

## What Went Well

1. **100% Acceptance Criteria Coverage**
   - All 13 stories achieved complete AC coverage
   - Every story passed Senior Developer Review with "Approve" outcome

2. **Zero Rework Required**
   - No code changes required after review (except Story 3.6 which needed two additional tests)
   - Clean implementations aligned with architecture

3. **Consistent Patterns Established**
   - Table-driven tests became the standard
   - Mock server patterns for HTTP testing
   - Error wrapping with `%w`
   - Structured logging with slog

4. **Strong Dependency Chain**
   - Stories built naturally: 2.1→2.2/2.3→2.4→2.5→2.6→3.1→3.2→...→3.7
   - No blocked stories due to missing dependencies

5. **Architecture Alignment**
   - ADR-001 (stdlib http) followed
   - ADR-003 (explicit errors) followed
   - ADR-004 (slog logging) followed
   - ADR-005 (minimal dependencies) followed

6. **Documentation Quality**
   - Dev Notes maintained throughout
   - Completion Notes captured learnings
   - File Lists tracked changes

7. **Epic 1 Retrospective Commitments Met**
   - All commitments from Epic 1 retro were applied

---

## What Could Be Improved

### 1. Missing Tech Specs (HIGH)

**Problem:** Neither Epic 2 nor Epic 3 had a tech spec document. Multiple Senior Developer Reviews noted "Epic 3 tech-spec not found" which made AC validation harder.

**Impact:**
- Reviewers had to rely on story context and architecture docs
- Traceability between FRs and implementation was less clear
- More effort required during review

**Resolution:** Added MANDATORY tech spec requirement to Epics 2, 3, 4, and 5.

### 2. No Smoke Test Guidance (HIGH)

**Problem:** All 13 stories only validated via `go build ./...`, `go test ./...`, and `make lint`. No actual runtime verification against real APIs or with real data.

**Impact:**
- No visibility on whether code actually runs in production scenarios
- Unit tests mock everything - never confirmed real API connectivity
- Cannot verify end-to-end behavior

**Resolution:** Added MANDATORY smoke test guide requirement to Epics 2, 3, 4, and 5. Each story must include a Smoke Test Guide in Dev Notes (or explicitly mark "N/A" for internal-only functions).

### 3. Story 3.6 Review Iteration (LOW)

**Problem:** Story 3.6 initially received "Blocked" outcome due to missing JSON serialization test and negative change test case.

**Impact:** Required one additional review cycle.

**Resolution:** Developer addressed both items quickly. Consider more thorough self-review before submitting for Senior Developer Review.

### 4. Sprint Status Tracking Minor Inconsistency (LOW)

**Problem:** Story 3.3 showed "review" status in sprint-status.yaml but review was already approved.

**Impact:** Minor confusion in status tracking.

**Resolution:** Ensure sprint-status.yaml is updated immediately after review approval.

---

## Action Items

| # | Action | Owner | Status |
|---|--------|-------|--------|
| 1 | Add MANDATORY tech spec requirement to all epics | Bob (SM) | DONE |
| 2 | Add MANDATORY smoke test guide requirement to all epics | Bob (SM) | DONE |
| 3 | Draft tech spec for Epic 4 before creating stories | SM/Architect | PENDING |
| 4 | Draft tech spec for Epic 5 before creating stories | SM/Architect | PENDING |
| 5 | Include smoke test guide in all Epic 4 stories | Dev Agent | PENDING |

---

## Epic 1 Retrospective Commitment Status

| Commitment | Status |
|-----------|--------|
| Continue thorough AC definitions | APPLIED |
| Document errgroup dependency for Epic 2 | APPLIED |
| Maintain dev notes quality | APPLIED |
| Continue Senior Developer Review process | APPLIED |
| Keep Go toolchain at 1.23 | APPLIED |

---

## Commitments for Epic 4

Based on this retrospective, the team commits to:

1. **Draft Epic 4 Tech Spec** before creating any stories
2. **Include Smoke Test Guide** in every story's Dev Notes
3. **Update sprint-status.yaml immediately** after review approval
4. **Self-review against ACs** before submitting for Senior Developer Review
5. **Clarify Snapshot struct location** - Epic 3 created it in `internal/aggregator/models.go`, Epic 4 references `internal/models/snapshot.go`. Resolve before implementation.

---

## Next Epic Preview

**Epic 4: State & History Management**
- 8 stories planned
- Goal: Incremental update tracking and historical snapshot management
- Dependencies: Story 3.7 (AggregationResult) - COMPLETE
- Key concern: Snapshot struct location needs clarification

---

## Metrics

| Metric | Epic 2 | Epic 3 | Combined |
|--------|--------|--------|----------|
| Stories Planned | 6 | 7 | 13 |
| Stories Completed | 6 | 7 | 13 |
| Completion Rate | 100% | 100% | 100% |
| Stories with Rework | 0 | 1 (3.6) | 1 |
| Review Blockers | 0 | 1 | 1 |

---

## Participants

- Bob (Scrum Master) - Facilitator
- Alice (Product Owner)
- Charlie (Senior Developer)
- Dana (QA Engineer)
- Elena (Junior Developer)
- BMad (Stakeholder)

---

## Change Log

| Date | Author | Change |
|------|--------|--------|
| 2025-11-30 | Bob (SM) | Initial retrospective document created |
