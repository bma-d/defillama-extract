# Architecture Decision Records (ADRs)

## ADR-001: Use Go Standard Library Over Frameworks

**Context:** CLI applications in Go can use frameworks like Cobra/Viper or the standard library.

**Decision:** Use `flag` (stdlib) for CLI parsing, `net/http` for HTTP, `encoding/json` for JSON.

**Rationale:**
- Simple CLI with 4 flags doesn't warrant framework overhead
- Fewer dependencies = smaller attack surface, easier maintenance
- Go stdlib is well-tested and stable

## ADR-002: Atomic File Writes

**Context:** Output files must never be corrupted, even on crash.

**Decision:** Write to temp file, then atomic rename.

**Rationale:**
- `os.Rename` is atomic on POSIX systems
- Readers always see complete previous version or complete new version
- No partial writes possible

## ADR-003: Explicit Error Returns Over Exceptions

**Context:** Go uses error values, not exceptions.

**Decision:** Return errors explicitly, wrap with context, use sentinel errors for expected conditions.

**Rationale:**
- Go idiom - errors are values
- Explicit error handling at each call site
- Error wrapping provides stack context
- Sentinel errors enable type-safe error checking

## ADR-004: Structured Logging with slog

**Context:** Need machine-parseable logs for operations.

**Decision:** Use `log/slog` (stdlib) with JSON output in daemon mode.

**Rationale:**
- Built into Go 1.21+ (no dependency)
- Structured fields enable log aggregation
- Text mode available for development

## ADR-005: Minimal External Dependencies

**Context:** Each dependency is a maintenance and security burden.

**Decision:** Only external dependency is `gopkg.in/yaml.v3` for config parsing.

**Rationale:**
- Go stdlib provides HTTP, JSON, logging, testing
- Prometheus client scoped to post-MVP
- Fewer deps = faster builds, smaller binary, less CVE exposure

---

_Generated by BMAD Decision Architecture Workflow v1.0_
_Date: 2025-11-29_
_For: BMad_
